{% extends "base.html" %}

{% block content %}

{% if user.is_authenticated %}
  <p>
    <a href="{% url 'dashboard' %}">My Dashboard</a>
  </p>
{% else %}
  <a href="{% url 'login' %}">Login</a> |
  <a href="{% url 'register' %}">Register</a>
{% endif %}

{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}

<h1>Distress Listings</h1>

<form method="get">
  <input
    type="text"
    name="search"
    placeholder="Search title or description"
    value="{{ request.GET.search }}"
  >
  <input
    type="text"
    name="location"
    placeholder="Location"
    value="{{ request.GET.location }}"
  >
  <button type="submit">Filter</button>
</form>

<table border="1" cellpadding="6">
  <tr>
    <th>Title</th>
    <th>Location</th>
    <th>Price</th>
    <th>Score</th>
    <th>Action</th>
  </tr>

  {% for p in properties %}
  <tr>
    <td>{{ p.title }}</td>
    <td>{{ p.location }}</td>
    <td>{{ p.price }}</td>
    <td>
      {{ p.distress_score }}
      {% if p.distress_score >= 5 %}
        <strong>(High)</strong>
      {% elif p.distress_score >= 3 %}
        (Medium)
      {% else %}
        (Low)
      {% endif %}
    </td>
    <td>
      {% if user.is_authenticated %}
        <form method="post" action="{% url 'add-favorite' p.id %}">
          {% csrf_token %}
          <button type="submit">Save</button>
        </form>
      {% else %}
        <em>Login to save</em>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>

{% endblock %}
